#!/usr/bin/env bash
#
# gen-build-manifest - Generate a manifest for current directory.
#
# usage:
#
#     # Generate manifest for this directory and all children:
#     gen-build-manifest > manifest.txt
#
#     # Generate manifest for another directory:
#     ( cd build/ ; gen-build-manifest ) > build-manifest.txt
#
#     # Filter out entries before writing if desired:
#     ( cd build/ ; gen-build-manifest ) | grep -v 'meta/' > build-manifest.txt
#
set -eo pipefail

hash find xargs sort sha512sum

find -L . -mindepth 1 -maxdepth 1 -xdev -type f -printf '%P\0' \
	| xargs -0 -n 1 -P "$(nproc)" -- sha512sum --tag \
	| sort -t '=' -k 1
